---
# ArgoCD PostSync hook to assign SCC
apiVersion: batch/v1
kind: Job
metadata:
  name: assign-scc-anyuid
  namespace: ecommerce-prod
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
spec:
  template:
    spec:
      serviceAccountName: default
      containers:
      - name: oc-cli
        image: image-registry.openshift-image-registry.svc:5000/openshift/cli:latest
        command:
        - /bin/bash
        - -c
        - |
          oc adm policy add-scc-to-user anyuid -z ecommerce-prod-sa -n ecommerce-prod
          echo "âœ… SCC anyuid assigned to ecommerce-prod-sa"
      restartPolicy: Never
  backoffLimit: 2
